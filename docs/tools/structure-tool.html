<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é¡¹ç›®ç»“æ„åˆ†æå·¥å…· - AIæ™ºèƒ½æŠ€æœ¯çŸ¥è¯†å¹³å°</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #000000 0%, #1a1a1a 50%, #2d1f0c 100%);
      color: #e0e0e0;
      padding: 20px;
      min-height: 100vh;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      padding: 30px 0;
      margin-bottom: 30px;
      border-bottom: 2px solid #d4af37;
    }

    .header h1 {
      color: #f4d03f;
      font-size: 2.5em;
      margin-bottom: 10px;
    }

    .header p {
      color: #c5c5c5;
      font-size: 1.1em;
    }

    .tip-box {
      background: rgba(244, 208, 63, 0.15);
      border: 2px solid #f4d03f;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 30px;
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .tip-icon {
      font-size: 48px;
    }

    .tip-content h3 {
      color: #f4d03f;
      margin-bottom: 8px;
    }

    .tip-content p {
      color: #c5c5c5;
      line-height: 1.6;
      margin: 0;
    }

    .tool-container {
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
      border: 2px solid #d4af37;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 4px 20px rgba(212, 175, 55, 0.3);
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
    }

    @media screen and (max-width: 768px) {
      .tool-container {
        grid-template-columns: 1fr;
      }
    }

    .button-group {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 25px;
      grid-column: 1 / -1;
      justify-content: center;
    }

    button {
      background: linear-gradient(135deg, #d4af37, #f4d03f);
      color: #000;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 2px 8px rgba(212, 175, 55, 0.4);
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(212, 175, 55, 0.6);
    }

    button.secondary-btn {
      background: rgba(212, 175, 55, 0.2);
      color: #f4d03f;
      border: 1px solid #d4af37;
    }

    button.clear-btn {
      background: rgba(255, 77, 77, 0.8);
      color: #fff;
    }

    .input-section, .output-section {
      display: flex;
      flex-direction: column;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .section-label {
      color: #d4af37;
      font-weight: 600;
      font-size: 16px;
    }

    .status {
      color: #c5c5c5;
      font-size: 14px;
    }

    textarea {
      width: 100%;
      height: 500px;
      background: #0a0a0a;
      border: 2px solid #b8960f;
      border-radius: 8px;
      padding: 15px;
      color: #e0e0e0;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 14px;
      resize: vertical;
      line-height: 1.5;
    }

    textarea:focus {
      outline: none;
      border-color: #d4af37;
      box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.2);
    }

    .tree-view {
      height: 500px;
      background: #0a0a0a;
      border: 2px solid #b8960f;
      border-radius: 8px;
      padding: 15px;
      overflow: auto;
      font-family: 'Segoe UI', sans-serif;
    }

    .tree-node {
      margin-left: 20px;
      line-height: 1.8;
    }

    .tree-content {
      display: flex;
      align-items: center;
      cursor: pointer;
      padding: 2px 5px;
      border-radius: 4px;
    }

    .tree-content:hover {
      background: rgba(212, 175, 55, 0.1);
    }

    .tree-icon {
      margin-right: 8px;
      width: 20px;
      text-align: center;
      color: #f4d03f;
    }

    .tree-label {
      color: #e0e0e0;
    }

    .tree-children {
      display: none;
    }

    .tree-children.expanded {
      display: block;
    }

    .tree-toggle {
      width: 16px;
      height: 16px;
      margin-right: 4px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      color: #888;
      transition: transform 0.2s;
    }

    .tree-toggle.expanded {
      transform: rotate(90deg);
    }

    .stats {
      margin-top: 15px;
      padding: 15px;
      background: rgba(212, 175, 55, 0.1);
      border-radius: 8px;
      color: #c5c5c5;
      font-size: 14px;
      grid-column: 1 / -1;
      display: none;
    }

    .stats.show {
      display: block;
    }

    .stats-content {
      display: flex;
      gap: 30px;
      flex-wrap: wrap;
    }

    .stat-item strong {
      color: #f4d03f;
    }

    .message {
      position: fixed;
      top: 100px;
      right: 30px;
      padding: 15px 25px;
      border-radius: 8px;
      font-weight: 600;
      z-index: 10000;
      animation: slideIn 0.3s ease;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    }

    .message.success {
      background: rgba(0, 255, 0, 0.2);
      color: #00ff00;
      border: 2px solid #00ff00;
    }

    .message.error {
      background: rgba(255, 68, 68, 0.2);
      color: #ff4444;
      border: 2px solid #ff4444;
    }

    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    @keyframes slideOut {
      from { transform: translateX(0); opacity: 1; }
      to { transform: translateX(100%); opacity: 0; }
    }

    .back-link {
      display: inline-block;
      margin-bottom: 20px;
      color: #d4af37;
      text-decoration: none;
      font-weight: 600;
      transition: color 0.3s;
    }

    .back-link:hover {
      color: #f4d03f;
    }
  </style>
</head>
<body>
  <div class="container">
    <div style="display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap;">
      <a href="/#/" class="back-link">â† è¿”å›ä¸»ç«™</a>
      <a href="index.html" class="back-link">â† è¿”å›å·¥å…·é›†</a>
    </div>
    
    <div class="header">
      <h1>ğŸ“‚ é¡¹ç›®ç»“æ„åˆ†æå·¥å…·</h1>
      <p>æ™ºèƒ½è§£æé¡¹ç›®æ–‡ä»¶ç»“æ„ï¼Œå¯è§†åŒ–åˆ†æä¸ç»Ÿè®¡</p>
    </div>

    <div class="tip-box">
      <div class="tip-icon">ğŸ’¡</div>
      <div class="tip-content">
        <h3>æ”¯æŒå¤šç§æ ¼å¼è¾“å…¥</h3>
        <p>
          â€¢ <strong>JSONæ ¼å¼</strong>ï¼šæ ‡å‡†çš„åµŒå¥—JSONå¯¹è±¡<br/>
          â€¢ <strong>Treeå‘½ä»¤è¾“å‡º</strong>ï¼šæ”¯æŒ `tree` å‘½ä»¤ç”Ÿæˆçš„æ–‡æœ¬æ ‘å½¢ç»“æ„<br/>
          â€¢ <strong>ç¼©è¿›æ–‡æœ¬</strong>ï¼šä½¿ç”¨ç©ºæ ¼æˆ–åˆ¶è¡¨ç¬¦ç¼©è¿›è¡¨ç¤ºå±‚çº§
        </p>
      </div>
    </div>

    <div class="tool-container">
      <div class="button-group">
        <button onclick="parseInput()">ğŸš€ è§£æç»“æ„</button>
        <button onclick="loadExample('json')" class="secondary-btn">ğŸ“„ ç¤ºä¾‹JSON</button>
        <button onclick="loadExample('tree')" class="secondary-btn">ğŸŒ³ ç¤ºä¾‹Tree</button>
        <button onclick="expandAll()" class="secondary-btn">â• å±•å¼€æ‰€æœ‰</button>
        <button onclick="collapseAll()" class="secondary-btn">â– æ”¶èµ·æ‰€æœ‰</button>
        <button onclick="runSelfTest()" class="secondary-btn">ğŸ§ª è¿è¡Œè‡ªæµ‹</button>
        <button onclick="clearAll()" class="clear-btn">ğŸ—‘ï¸ æ¸…ç©º</button>
      </div>

      <div class="input-section">
        <div class="section-header">
          <span class="section-label">ğŸ“ è¾“å…¥ç»“æ„æ•°æ®</span>
          <span class="status" id="status">ç­‰å¾…è¾“å…¥...</span>
        </div>
        <textarea id="input" placeholder="è¯·ç²˜è´´ JSON æˆ– Tree å‘½ä»¤è¾“å‡º..."></textarea>
      </div>

      <div class="output-section">
        <div class="section-header">
          <span class="section-label">ğŸ‘€ å¯è§†åŒ–é¢„è§ˆ</span>
          <button onclick="exportJSON()" class="secondary-btn" style="padding: 4px 10px; font-size: 12px;">ğŸ“¤ å¯¼å‡ºJSON</button>
        </div>
        <div id="treeView" class="tree-view"></div>
      </div>

      <div class="stats" id="stats">
        <div class="stats-content">
          <span class="stat-item">ğŸ“ ç›®å½•æ•°: <strong id="dirCount">0</strong></span>
          <span class="stat-item">ğŸ“„ æ–‡ä»¶æ•°: <strong id="fileCount">0</strong></span>
          <span class="stat-item">ğŸ“ æœ€å¤§æ·±åº¦: <strong id="maxDepth">0</strong></span>
          <span class="stat-item">â±ï¸ è§£æè€—æ—¶: <strong id="parseTime">0ms</strong></span>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ç¤ºä¾‹æ•°æ®
    const examples = {
      json: JSON.stringify({
        "project": {
          "src": {
            "components": {
              "Button.js": {},
              "Header.js": {}
            },
            "utils": {
              "api.js": {},
              "format.js": {}
            },
            "App.js": {},
            "index.js": {}
          },
          "public": {
            "index.html": {},
            "favicon.ico": {}
          },
          "package.json": {},
          "README.md": {}
        }
      }, null, 2),
      
      tree: `project
â”œâ”€â”€ src
â”‚   â”œâ”€â”€ components
â”‚   â”‚   â”œâ”€â”€ Button.js
â”‚   â”‚   â””â”€â”€ Header.js
â”‚   â”œâ”€â”€ utils
â”‚   â”‚   â”œâ”€â”€ api.js
â”‚   â”‚   â””â”€â”€ format.js
â”‚   â”œâ”€â”€ App.js
â”‚   â””â”€â”€ index.js
â”œâ”€â”€ public
â”‚   â”œâ”€â”€ index.html
â”‚   â””â”€â”€ favicon.ico
â”œâ”€â”€ package.json
â””â”€â”€ README.md`
    };

    let currentData = null;

    // åŠ è½½ç¤ºä¾‹
    function loadExample(type) {
      document.getElementById('input').value = examples[type];
      parseInput();
    }

    // æ¸…ç©º
    function clearAll() {
      document.getElementById('input').value = '';
      document.getElementById('treeView').innerHTML = '';
      document.getElementById('stats').classList.remove('show');
      document.getElementById('status').textContent = 'ç­‰å¾…è¾“å…¥...';
      document.getElementById('status').style.color = '#c5c5c5';
      currentData = null;
    }

    // è§£æå…¥å£
    function parseInput() {
      const input = document.getElementById('input').value.trim();
      const startTime = performance.now();
      
      if (!input) {
        showMessage('è¯·è¾“å…¥å†…å®¹', 'error');
        return;
      }

      try {
        // å°è¯•JSONè§£æ
        if (input.startsWith('{')) {
          currentData = JSON.parse(input);
          renderTree(currentData);
          updateStats(currentData, startTime);
          showMessage('JSONè§£ææˆåŠŸ', 'success');
        } else {
          // å°è¯•Treeè§£æ
          currentData = parseTreeString(input);
          renderTree(currentData);
          updateStats(currentData, startTime);
          showMessage('Treeè§£ææˆåŠŸ', 'success');
        }
        document.getElementById('status').textContent = 'âœ“ è§£ææˆåŠŸ';
        document.getElementById('status').style.color = '#00ff00';
      } catch (e) {
        showMessage('è§£æå¤±è´¥: ' + e.message, 'error');
        document.getElementById('status').textContent = 'âœ— è§£æå¤±è´¥';
        document.getElementById('status').style.color = '#ff4444';
        console.error(e);
      }
    }

    // Treeå­—ç¬¦ä¸²è§£æé€»è¾‘
    function parseTreeString(str) {
      const lines = str.split('\n').filter(line => line.trim());
      const root = {};
      const stack = [{ node: root, level: -1 }];

      lines.forEach(line => {
        // è®¡ç®—å±‚çº§ï¼šæ£€æµ‹ç¼©è¿›æˆ–ç‰¹æ®Šç¬¦å·
        // treeå‘½ä»¤é€šå¸¸ä½¿ç”¨ â”‚   , â”œâ”€â”€ , â””â”€â”€ 
        // ç®€å•ç­–ç•¥ï¼šè®¡ç®—å‰å¯¼éæ–‡ä»¶åå­—ç¬¦çš„é•¿åº¦
        const match = line.match(/^([â”‚\sâ”œâ””â”€]*)(.*)/);
        if (!match) return;

        let prefix = match[1];
        let name = match[2].trim();
        
        // ä¼°ç®—å±‚çº§ï¼šæ¯4ä¸ªå­—ç¬¦ä¸€å±‚ï¼Œæˆ–è€…æ ¹æ®â”œâ”€â”€ç»“æ„
        // è¿™é‡Œç®€åŒ–å¤„ç†ï¼šç›´æ¥ç»Ÿè®¡å‰å¯¼ç‰¹æ®Šå­—ç¬¦æ•°é‡
        // å¯¹äºæ ‡å‡†treeè¾“å‡ºï¼Œæ¯å±‚é€šå¸¸æ˜¯4ä¸ªå­—ç¬¦ "â”‚   " æˆ– "â”œâ”€â”€ "
        let level = Math.floor(prefix.length / 4);
        
        // æ ¹èŠ‚ç‚¹ç‰¹æ®Šå¤„ç†
        if (level === 0 && prefix.length === 0) {
          level = 0;
        }

        const newNode = {};
        
        // æ‰¾åˆ°çˆ¶èŠ‚ç‚¹
        while (stack.length > 0 && stack[stack.length - 1].level >= level) {
          stack.pop();
        }

        const parent = stack[stack.length - 1].node;
        
        // å¦‚æœparentæ˜¯ç©ºå¯¹è±¡ï¼ˆå¯èƒ½æ˜¯æ–‡ä»¶ï¼‰ï¼Œåˆ™ä¸èƒ½æ·»åŠ å­èŠ‚ç‚¹ï¼Œè¿™åœ¨æ ‡å‡†Treeä¸­ä¸åº”å‘ç”Ÿ
        // ä½†ä¸ºäº†å®¹é”™ï¼Œæˆ‘ä»¬å‡è®¾å®ƒå˜æˆäº†ç›®å½•
        parent[name] = newNode;
        stack.push({ node: newNode, level: level });
      });

      // å¦‚æœåªæœ‰ä¸€ä¸ªæ ¹èŠ‚ç‚¹ï¼Œè¿”å›è¯¥æ ¹èŠ‚ç‚¹çš„å†…å®¹ï¼Œæˆ–è€…ä¿ç•™æ ¹èŠ‚ç‚¹
      // ä¸ºäº†ç»Ÿä¸€ï¼Œæˆ‘ä»¬è¿”å›æ•´ä¸ªç»“æ„
      return root;
    }

    // æ¸²æŸ“æ ‘
    function renderTree(data) {
      const container = document.getElementById('treeView');
      container.innerHTML = '';
      container.appendChild(createTreeNode(data, 'root', true));
    }

    function createTreeNode(node, name, isRoot = false) {
      const isDir = Object.keys(node).length > 0;
      const div = document.createElement('div');
      div.className = 'tree-node';

      const content = document.createElement('div');
      content.className = 'tree-content';
      
      const toggle = document.createElement('span');
      toggle.className = 'tree-toggle' + (isDir ? ' expanded' : '');
      toggle.textContent = isDir ? 'â–¶' : '';
      
      const icon = document.createElement('span');
      icon.className = 'tree-icon';
      icon.textContent = isDir ? 'ğŸ“‚' : 'ğŸ“„';

      const label = document.createElement('span');
      label.className = 'tree-label';
      label.textContent = name === 'root' && isRoot ? 'Project Root' : name;

      content.appendChild(toggle);
      content.appendChild(icon);
      content.appendChild(label);
      div.appendChild(content);

      if (isDir) {
        const childrenContainer = document.createElement('div');
        childrenContainer.className = 'tree-children expanded';
        
        for (const [key, value] of Object.entries(node)) {
          childrenContainer.appendChild(createTreeNode(value, key));
        }
        
        div.appendChild(childrenContainer);

        content.addEventListener('click', (e) => {
          e.stopPropagation();
          childrenContainer.classList.toggle('expanded');
          toggle.classList.toggle('expanded');
          icon.textContent = childrenContainer.classList.contains('expanded') ? 'ğŸ“‚' : 'ğŸ“';
        });
      }

      return div;
    }

    // ç»Ÿè®¡æ›´æ–°
    function updateStats(data, startTime) {
      let files = 0;
      let dirs = 0;
      let maxDepth = 0;

      function traverse(node, depth) {
        const keys = Object.keys(node);
        if (keys.length > 0) {
          dirs++;
          if (depth > maxDepth) maxDepth = depth;
          keys.forEach(key => traverse(node[key], depth + 1));
        } else {
          files++;
          if (depth > maxDepth) maxDepth = depth;
        }
      }

      // å¦‚æœæ ¹èŠ‚ç‚¹åŒ…å«å¤šä¸ªé¡¹ç›®ï¼Œè§†ä½œç¬¬ä¸€å±‚
      traverse(data, 0);
      // æ ¹èŠ‚ç‚¹æœ¬èº«ä¸ç®—ç›®å½•ï¼Œå‡1
      dirs = Math.max(0, dirs - 1);

      document.getElementById('dirCount').textContent = dirs;
      document.getElementById('fileCount').textContent = files;
      document.getElementById('maxDepth').textContent = maxDepth;
      
      const endTime = performance.now();
      document.getElementById('parseTime').textContent = (endTime - startTime).toFixed(2) + 'ms';
      document.getElementById('stats').classList.add('show');
    }

    // å±•å¼€/æ”¶èµ·
    function expandAll() {
      document.querySelectorAll('.tree-children').forEach(el => el.classList.add('expanded'));
      document.querySelectorAll('.tree-toggle').forEach(el => el.classList.add('expanded'));
    }

    function collapseAll() {
      document.querySelectorAll('.tree-children').forEach(el => el.classList.remove('expanded'));
      document.querySelectorAll('.tree-toggle').forEach(el => el.classList.remove('expanded'));
    }

    // å¯¼å‡º
    function exportJSON() {
      if (!currentData) {
        showMessage('æ²¡æœ‰æ•°æ®å¯å¯¼å‡º', 'error');
        return;
      }
      const jsonStr = JSON.stringify(currentData, null, 2);
      const blob = new Blob([jsonStr], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'project-structure.json';
      a.click();
      URL.revokeObjectURL(url);
      showMessage('JSONå¯¼å‡ºæˆåŠŸ', 'success');
    }

    // æ¶ˆæ¯æç¤º
    function showMessage(message, type) {
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${type}`;
      messageDiv.textContent = message;
      document.body.appendChild(messageDiv);
      setTimeout(() => {
        messageDiv.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => document.body.removeChild(messageDiv), 300);
      }, 2000);
    }

    // è‡ªæµ‹åŠŸèƒ½
    function runSelfTest() {
      const tests = [
        {
          name: 'JSON Parse Test',
          input: '{"a": {"b": {}}}',
          expect: (res) => res.a && res.a.b
        },
        {
          name: 'Tree Parse Test',
          input: 'root\nâ”œâ”€â”€ a\nâ”‚   â””â”€â”€ b',
          expect: (res) => res.root && res.root.a && res.root.a.b
        }
      ];

      let passed = 0;
      tests.forEach(test => {
        try {
          let res;
          if (test.input.startsWith('{')) {
            res = JSON.parse(test.input);
          } else {
            res = parseTreeString(test.input);
          }
          
          if (test.expect(res)) {
            console.log(`âœ… ${test.name} Passed`);
            passed++;
          } else {
            console.error(`âŒ ${test.name} Failed`);
          }
        } catch (e) {
          console.error(`âŒ ${test.name} Error:`, e);
        }
      });

      if (passed === tests.length) {
        showMessage(`è‡ªæµ‹é€šè¿‡: ${passed}/${tests.length}`, 'success');
      } else {
        showMessage(`è‡ªæµ‹å¤±è´¥: ${passed}/${tests.length}`, 'error');
      }
    }
  </script>
</body>
</html>
