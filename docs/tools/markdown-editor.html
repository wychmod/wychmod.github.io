<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Markdown ç¼–è¾‘å™¨ - AIæ™ºèƒ½æŠ€æœ¯çŸ¥è¯†å¹³å°</title>
  <meta name="description" content="åœ¨çº¿Markdownç¼–è¾‘å™¨ï¼Œæ”¯æŒå®æ—¶é¢„è§ˆã€è¯­æ³•é«˜äº®ã€å¯¼å‡ºHTMLå’ŒPDFåŠŸèƒ½">
  <meta name="keywords" content="Markdownç¼–è¾‘å™¨,Markdowné¢„è§ˆ,åœ¨çº¿ç¼–è¾‘,HTMLå¯¼å‡º,PDFå¯¼å‡º">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --gold-main: #d4af37;
      --gold-light: #f4d03f;
      --gold-dark: #b8960f;
      --bg-primary: #0a0a0a;
      --bg-secondary: #1a1a1a;
      --bg-tertiary: #2a2a2a;
      --text-primary: #e0e0e0;
      --text-secondary: #c5c5c5;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'PingFang SC', 'Microsoft YaHei', sans-serif;
      background: linear-gradient(135deg, #000000 0%, #1a1a1a 50%, #2d1f0c 100%);
      color: var(--text-primary);
      padding: 20px;
      min-height: 100vh;
      line-height: 1.6;
    }

    .container {
      max-width: 1600px;
      margin: 0 auto;
    }

    .back-link {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      color: var(--gold-main);
      text-decoration: none;
      font-weight: 600;
      font-size: 16px;
      padding: 10px 20px;
      border: 2px solid var(--gold-dark);
      border-radius: 25px;
      transition: all 0.3s ease;
      background: rgba(212, 175, 55, 0.1);
      margin-bottom: 20px;
    }

    .back-link:hover {
      color: var(--gold-light);
      border-color: var(--gold-light);
      transform: translateX(-5px);
      box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
    }

    .header {
      text-align: center;
      padding: 25px 0;
      margin-bottom: 25px;
      border-bottom: 2px solid var(--gold-main);
    }

    .header h1 {
      color: var(--gold-light);
      font-size: 2.5em;
      margin-bottom: 10px;
      text-shadow: 0 2px 10px rgba(244, 208, 63, 0.3);
    }

    .header p {
      color: var(--text-secondary);
      font-size: 1.1em;
    }

    /* å·¥å…·æ  */
    .toolbar {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      padding: 15px;
      background: var(--bg-tertiary);
      border-radius: 12px 12px 0 0;
      border: 2px solid var(--gold-dark);
      border-bottom: none;
      align-items: center;
    }

    .toolbar-group {
      display: flex;
      gap: 5px;
      padding-right: 15px;
      border-right: 1px solid var(--gold-dark);
    }

    .toolbar-group:last-child {
      border-right: none;
      margin-left: auto;
    }

    .toolbar button {
      background: var(--bg-secondary);
      color: var(--gold-main);
      border: 1px solid var(--gold-dark);
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .toolbar button:hover {
      background: rgba(212, 175, 55, 0.2);
      border-color: var(--gold-main);
      transform: translateY(-1px);
    }

    .toolbar button.primary {
      background: linear-gradient(135deg, var(--gold-dark), var(--gold-main));
      color: #000;
      font-weight: 600;
    }

    .toolbar button.primary:hover {
      background: linear-gradient(135deg, var(--gold-main), var(--gold-light));
    }

    /* ç¼–è¾‘å™¨å®¹å™¨ */
    .editor-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0;
      background: var(--bg-secondary);
      border: 2px solid var(--gold-dark);
      border-radius: 0 0 12px 12px;
      overflow: hidden;
      min-height: 600px;
    }

    @media (max-width: 1024px) {
      .editor-container {
        grid-template-columns: 1fr;
        grid-template-rows: 1fr 1fr;
      }
    }

    /* ç¼–è¾‘é¢æ¿ */
    .editor-panel, .preview-panel {
      display: flex;
      flex-direction: column;
    }

    .editor-panel {
      border-right: 2px solid var(--gold-dark);
    }

    @media (max-width: 1024px) {
      .editor-panel {
        border-right: none;
        border-bottom: 2px solid var(--gold-dark);
      }
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 15px;
      background: var(--bg-tertiary);
      border-bottom: 1px solid var(--gold-dark);
    }

    .panel-title {
      color: var(--gold-main);
      font-weight: 600;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .panel-info {
      color: var(--text-secondary);
      font-size: 12px;
    }

    /* Markdownç¼–è¾‘å™¨ */
    .markdown-input {
      flex: 1;
      width: 100%;
      background: var(--bg-primary);
      border: none;
      padding: 20px;
      color: var(--text-primary);
      font-family: 'Consolas', 'Monaco', 'Fira Code', monospace;
      font-size: 14px;
      line-height: 1.8;
      resize: none;
      tab-size: 2;
    }

    .markdown-input:focus {
      outline: none;
    }

    /* é¢„è§ˆåŒºåŸŸ */
    .preview-content {
      flex: 1;
      padding: 20px;
      background: var(--bg-primary);
      overflow-y: auto;
      color: var(--text-primary);
    }

    /* Markdown æ¸²æŸ“æ ·å¼ */
    .preview-content h1 {
      color: var(--gold-light);
      font-size: 2em;
      margin: 0 0 20px 0;
      padding-bottom: 10px;
      border-bottom: 2px solid var(--gold-main);
    }

    .preview-content h2 {
      color: var(--gold-main);
      font-size: 1.6em;
      margin: 25px 0 15px 0;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--gold-dark);
    }

    .preview-content h3 {
      color: var(--gold-main);
      font-size: 1.3em;
      margin: 20px 0 12px 0;
    }

    .preview-content h4, .preview-content h5, .preview-content h6 {
      color: var(--text-primary);
      margin: 15px 0 10px 0;
    }

    .preview-content p {
      margin: 12px 0;
      line-height: 1.8;
    }

    .preview-content a {
      color: var(--gold-main);
      text-decoration: none;
    }

    .preview-content a:hover {
      color: var(--gold-light);
      text-decoration: underline;
    }

    .preview-content strong {
      color: var(--gold-light);
      font-weight: 600;
    }

    .preview-content em {
      font-style: italic;
      color: var(--text-secondary);
    }

    .preview-content code {
      background: rgba(212, 175, 55, 0.15);
      color: var(--gold-main);
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 0.9em;
    }

    .preview-content pre {
      background: var(--bg-secondary);
      border: 1px solid var(--gold-dark);
      border-radius: 8px;
      padding: 15px;
      overflow-x: auto;
      margin: 15px 0;
    }

    .preview-content pre code {
      background: none;
      padding: 0;
      color: var(--text-primary);
    }

    .preview-content blockquote {
      border-left: 4px solid var(--gold-main);
      background: rgba(212, 175, 55, 0.1);
      padding: 15px 20px;
      margin: 15px 0;
      border-radius: 0 8px 8px 0;
    }

    .preview-content blockquote p {
      margin: 0;
    }

    .preview-content ul, .preview-content ol {
      padding-left: 25px;
      margin: 12px 0;
    }

    .preview-content li {
      margin: 8px 0;
      line-height: 1.6;
    }

    .preview-content hr {
      border: none;
      border-top: 2px solid var(--gold-dark);
      margin: 25px 0;
    }

    .preview-content table {
      width: 100%;
      border-collapse: collapse;
      margin: 15px 0;
    }

    .preview-content th {
      background: linear-gradient(135deg, var(--bg-tertiary), var(--bg-secondary));
      color: var(--gold-main);
      font-weight: 600;
      padding: 12px;
      text-align: left;
      border: 1px solid var(--gold-dark);
    }

    .preview-content td {
      padding: 10px 12px;
      border: 1px solid var(--gold-dark);
    }

    .preview-content tr:nth-child(even) {
      background: rgba(212, 175, 55, 0.05);
    }

    .preview-content img {
      max-width: 100%;
      border-radius: 8px;
      margin: 15px 0;
    }

    .preview-content .task-list-item {
      list-style: none;
      margin-left: -25px;
    }

    .preview-content .task-list-item input {
      margin-right: 8px;
    }

    /* Toasté€šçŸ¥ */
    .toast {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
      border: 2px solid var(--gold-main);
      border-radius: 12px;
      padding: 15px 25px;
      color: var(--text-primary);
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
      z-index: 1000;
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s ease;
    }

    .toast.show {
      transform: translateY(0);
      opacity: 1;
    }

    .toast.success {
      border-color: #4caf50;
    }

    .toast.error {
      border-color: #f44336;
    }

    /* å¸®åŠ©æç¤º */
    .help-section {
      margin-top: 25px;
      background: rgba(212, 175, 55, 0.1);
      border: 2px solid var(--gold-dark);
      border-radius: 12px;
      padding: 25px;
    }

    .help-section h3 {
      color: var(--gold-light);
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .syntax-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }

    .syntax-item {
      background: var(--bg-secondary);
      padding: 12px;
      border-radius: 8px;
      border: 1px solid var(--gold-dark);
    }

    .syntax-item code {
      color: var(--gold-main);
      font-family: monospace;
      font-size: 13px;
    }

    .syntax-item span {
      color: var(--text-secondary);
      font-size: 12px;
      display: block;
      margin-top: 5px;
    }

    /* é¡µè„š */
    .footer {
      text-align: center;
      padding: 30px 20px;
      margin-top: 40px;
      border-top: 1px solid var(--bg-tertiary);
      color: var(--text-secondary);
    }

    .footer a {
      color: var(--gold-main);
      text-decoration: none;
    }

    .footer a:hover {
      color: var(--gold-light);
    }

    /* å“åº”å¼ */
    @media (max-width: 768px) {
      .header h1 {
        font-size: 1.8em;
      }

      .toolbar {
        padding: 10px;
      }

      .toolbar-group {
        padding-right: 10px;
      }

      .toolbar button {
        padding: 6px 10px;
        font-size: 13px;
      }

      .editor-container {
        min-height: 400px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <a href="/tools/" class="back-link">â† è¿”å›å·¥å…·é›†</a>

    <div class="header">
      <h1>ğŸ“ Markdown ç¼–è¾‘å™¨</h1>
      <p>å®æ—¶é¢„è§ˆ Â· è¯­æ³•é«˜äº® Â· ä¸€é”®å¯¼å‡º</p>
    </div>

    <!-- å·¥å…·æ  -->
    <div class="toolbar">
      <div class="toolbar-group">
        <button onclick="insertText('**', '**')" title="åŠ ç²— (Ctrl+B)"><b>B</b></button>
        <button onclick="insertText('*', '*')" title="æ–œä½“ (Ctrl+I)"><i>I</i></button>
        <button onclick="insertText('~~', '~~')" title="åˆ é™¤çº¿"><s>S</s></button>
        <button onclick="insertText('`', '`')" title="è¡Œå†…ä»£ç ">&lt;/&gt;</button>
      </div>
      <div class="toolbar-group">
        <button onclick="insertHeading(1)" title="ä¸€çº§æ ‡é¢˜">H1</button>
        <button onclick="insertHeading(2)" title="äºŒçº§æ ‡é¢˜">H2</button>
        <button onclick="insertHeading(3)" title="ä¸‰çº§æ ‡é¢˜">H3</button>
      </div>
      <div class="toolbar-group">
        <button onclick="insertList('ul')" title="æ— åºåˆ—è¡¨">â€¢ åˆ—è¡¨</button>
        <button onclick="insertList('ol')" title="æœ‰åºåˆ—è¡¨">1. åˆ—è¡¨</button>
        <button onclick="insertList('task')" title="ä»»åŠ¡åˆ—è¡¨">â˜ ä»»åŠ¡</button>
      </div>
      <div class="toolbar-group">
        <button onclick="insertLink()" title="æ’å…¥é“¾æ¥">ğŸ”— é“¾æ¥</button>
        <button onclick="insertImage()" title="æ’å…¥å›¾ç‰‡">ğŸ–¼ï¸ å›¾ç‰‡</button>
        <button onclick="insertTable()" title="æ’å…¥è¡¨æ ¼">ğŸ“Š è¡¨æ ¼</button>
        <button onclick="insertCodeBlock()" title="ä»£ç å—">ğŸ“¦ ä»£ç å—</button>
      </div>
      <div class="toolbar-group">
        <button onclick="insertQuote()" title="å¼•ç”¨å—">ğŸ’¬ å¼•ç”¨</button>
        <button onclick="insertHr()" title="åˆ†éš”çº¿">â€” åˆ†éš”</button>
      </div>
      <div class="toolbar-group">
        <button onclick="exportHTML()" class="primary" title="å¯¼å‡ºä¸ºHTML">ğŸ“„ å¯¼å‡ºHTML</button>
        <button onclick="exportPDF()" class="primary" title="å¯¼å‡ºä¸ºPDF">ğŸ“‘ å¯¼å‡ºPDF</button>
        <button onclick="clearEditor()" title="æ¸…ç©ºç¼–è¾‘å™¨">ğŸ—‘ï¸ æ¸…ç©º</button>
      </div>
    </div>

    <!-- ç¼–è¾‘å™¨å®¹å™¨ -->
    <div class="editor-container">
      <!-- ç¼–è¾‘é¢æ¿ -->
      <div class="editor-panel">
        <div class="panel-header">
          <span class="panel-title">ğŸ“ Markdown ç¼–è¾‘</span>
          <span class="panel-info" id="charCount">0 å­—ç¬¦</span>
        </div>
        <textarea 
          class="markdown-input" 
          id="markdownInput" 
          placeholder="åœ¨æ­¤è¾“å…¥ Markdown å†…å®¹..."
          spellcheck="false"
        ></textarea>
      </div>

      <!-- é¢„è§ˆé¢æ¿ -->
      <div class="preview-panel">
        <div class="panel-header">
          <span class="panel-title">ğŸ‘ï¸ å®æ—¶é¢„è§ˆ</span>
          <span class="panel-info" id="wordCount">0 å­—</span>
        </div>
        <div class="preview-content" id="previewContent"></div>
      </div>
    </div>

    <!-- è¯­æ³•å¸®åŠ© -->
    <div class="help-section">
      <h3>ğŸ“– Markdown è¯­æ³•é€ŸæŸ¥</h3>
      <div class="syntax-grid">
        <div class="syntax-item">
          <code># æ ‡é¢˜</code>
          <span>ä¸€çº§åˆ°å…­çº§æ ‡é¢˜ (# ~ ######)</span>
        </div>
        <div class="syntax-item">
          <code>**ç²—ä½“** æˆ– *æ–œä½“*</code>
          <span>æ–‡æœ¬æ ¼å¼åŒ–</span>
        </div>
        <div class="syntax-item">
          <code>[é“¾æ¥æ–‡æœ¬](URL)</code>
          <span>è¶…é“¾æ¥</span>
        </div>
        <div class="syntax-item">
          <code>![å›¾ç‰‡æè¿°](URL)</code>
          <span>å›¾ç‰‡</span>
        </div>
        <div class="syntax-item">
          <code>`ä»£ç ` æˆ– ```ä»£ç å—```</code>
          <span>ä»£ç å±•ç¤º</span>
        </div>
        <div class="syntax-item">
          <code>> å¼•ç”¨æ–‡æœ¬</code>
          <span>å¼•ç”¨å—</span>
        </div>
        <div class="syntax-item">
          <code>- æˆ– * æˆ– 1.</code>
          <span>åˆ—è¡¨</span>
        </div>
        <div class="syntax-item">
          <code>| è¡¨å¤´ | è¡¨å¤´ |</code>
          <span>è¡¨æ ¼</span>
        </div>
      </div>
    </div>

    <div class="footer">
      <p>Â© 2024-2026 AIæ™ºèƒ½æŠ€æœ¯çŸ¥è¯†å¹³å° | 
        <a href="https://github.com/wychmod/wychmod.github.io" target="_blank">GitHub</a> | 
        <a href="/tools/">æ›´å¤šå·¥å…·</a>
      </p>
    </div>
  </div>

  <!-- Toast é€šçŸ¥ -->
  <div class="toast" id="toast"></div>

  <script>
    // é»˜è®¤Markdownç¤ºä¾‹
    const defaultMarkdown = `# Markdown ç¼–è¾‘å™¨æ¼”ç¤º

æ¬¢è¿ä½¿ç”¨ **Markdown ç¼–è¾‘å™¨**ï¼è¿™æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„åœ¨çº¿ç¼–è¾‘å·¥å…·ã€‚

## åŸºæœ¬è¯­æ³•ç¤ºä¾‹

### æ–‡æœ¬æ ¼å¼

è¿™æ˜¯ä¸€æ®µæ™®é€šæ–‡æœ¬ã€‚ä½ å¯ä»¥ä½¿ç”¨ **ç²—ä½“**ã€*æ–œä½“*ã€~~åˆ é™¤çº¿~~ æ¥å¼ºè°ƒæ–‡æœ¬ã€‚

ä¹Ÿå¯ä»¥ä½¿ç”¨ \`è¡Œå†…ä»£ç \` æ¥å±•ç¤ºä»£ç ç‰‡æ®µã€‚

### åˆ—è¡¨

æ— åºåˆ—è¡¨ï¼š
- é¡¹ç›® 1
- é¡¹ç›® 2
  - åµŒå¥—é¡¹ç›® 2.1
  - åµŒå¥—é¡¹ç›® 2.2
- é¡¹ç›® 3

æœ‰åºåˆ—è¡¨ï¼š
1. ç¬¬ä¸€æ­¥
2. ç¬¬äºŒæ­¥
3. ç¬¬ä¸‰æ­¥

ä»»åŠ¡åˆ—è¡¨ï¼š
- [x] å·²å®Œæˆçš„ä»»åŠ¡
- [ ] å¾…åŠä»»åŠ¡
- [ ] å¦ä¸€ä¸ªå¾…åŠ

### å¼•ç”¨

> è¿™æ˜¯ä¸€æ®µå¼•ç”¨æ–‡æœ¬ã€‚
> Markdown è®©å†™ä½œå˜å¾—æ›´åŠ ç®€å•å’Œä¼˜é›…ã€‚
> â€” ä½œè€…

### ä»£ç å—

\`\`\`javascript
function greet(name) {
  console.log(\`Hello, \${name}!\`);
  return true;
}

greet('World');
\`\`\`

### è¡¨æ ¼

| åŠŸèƒ½ | å¿«æ·é”® | è¯´æ˜ |
|------|--------|------|
| åŠ ç²— | Ctrl+B | å°†é€‰ä¸­æ–‡æœ¬åŠ ç²— |
| æ–œä½“ | Ctrl+I | å°†é€‰ä¸­æ–‡æœ¬å˜ä¸ºæ–œä½“ |
| é“¾æ¥ | Ctrl+K | æ’å…¥è¶…é“¾æ¥ |

### é“¾æ¥å’Œå›¾ç‰‡

è¿™æ˜¯ä¸€ä¸ª [é“¾æ¥ç¤ºä¾‹](https://github.com)ã€‚

å›¾ç‰‡ç¤ºä¾‹ï¼š
![ç¤ºä¾‹å›¾ç‰‡](https://via.placeholder.com/400x200/1a1a1a/d4af37?text=Markdown+Editor)

### åˆ†éš”çº¿

---

## é«˜çº§åŠŸèƒ½

æœ¬ç¼–è¾‘å™¨æ”¯æŒï¼š
- âœ… å®æ—¶é¢„è§ˆ
- âœ… è¯­æ³•é«˜äº®
- âœ… å¯¼å‡º HTML
- âœ… å¯¼å‡º PDF
- âœ… å¿«æ·é”®æ“ä½œ

å¼€å§‹ä½ çš„åˆ›ä½œå§ï¼ğŸš€
`;

    // DOMå…ƒç´ 
    const markdownInput = document.getElementById('markdownInput');
    const previewContent = document.getElementById('previewContent');
    const charCount = document.getElementById('charCount');
    const wordCount = document.getElementById('wordCount');
    const toast = document.getElementById('toast');

    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
      markdownInput.value = defaultMarkdown;
      updatePreview();
      updateCounts();
      
      // å®æ—¶é¢„è§ˆ
      markdownInput.addEventListener('input', function() {
        updatePreview();
        updateCounts();
      });
      
      // å¿«æ·é”®æ”¯æŒ
      markdownInput.addEventListener('keydown', handleKeyboard);
      
      // Tabé”®æ”¯æŒ
      markdownInput.addEventListener('keydown', function(e) {
        if (e.key === 'Tab') {
          e.preventDefault();
          insertAtCursor('  ');
        }
      });
    });

    // æ›´æ–°é¢„è§ˆ
    function updatePreview() {
      const markdown = markdownInput.value;
      const html = parseMarkdown(markdown);
      previewContent.innerHTML = html;
    }

    // æ›´æ–°å­—æ•°ç»Ÿè®¡
    function updateCounts() {
      const text = markdownInput.value;
      charCount.textContent = `${text.length.toLocaleString()} å­—ç¬¦`;
      
      // ç»Ÿè®¡ä¸­æ–‡å­—æ•°å’Œè‹±æ–‡å•è¯æ•°
      const chineseChars = (text.match(/[\u4e00-\u9fa5]/g) || []).length;
      const englishWords = (text.match(/[a-zA-Z]+/g) || []).length;
      wordCount.textContent = `${chineseChars} å­— / ${englishWords} è¯`;
    }

    // Markdownè§£æå™¨
    function parseMarkdown(md) {
      let html = md;
      
      // è½¬ä¹‰HTMLç‰¹æ®Šå­—ç¬¦ï¼ˆåœ¨ä»£ç å—ä¹‹å¤–ï¼‰
      // å…ˆå¤„ç†ä»£ç å—ï¼Œä¿æŠ¤å…¶å†…å®¹
      const codeBlocks = [];
      html = html.replace(/```(\w*)\n?([\s\S]*?)```/g, (match, lang, code) => {
        const index = codeBlocks.length;
        codeBlocks.push(`<pre><code class="language-${lang}">${escapeHtml(code.trim())}</code></pre>`);
        return `___CODEBLOCK_${index}___`;
      });
      
      // è¡Œå†…ä»£ç 
      const inlineCodes = [];
      html = html.replace(/`([^`]+)`/g, (match, code) => {
        const index = inlineCodes.length;
        inlineCodes.push(`<code>${escapeHtml(code)}</code>`);
        return `___INLINECODE_${index}___`;
      });

      // æ ‡é¢˜
      html = html.replace(/^###### (.+)$/gm, '<h6>$1</h6>');
      html = html.replace(/^##### (.+)$/gm, '<h5>$1</h5>');
      html = html.replace(/^#### (.+)$/gm, '<h4>$1</h4>');
      html = html.replace(/^### (.+)$/gm, '<h3>$1</h3>');
      html = html.replace(/^## (.+)$/gm, '<h2>$1</h2>');
      html = html.replace(/^# (.+)$/gm, '<h1>$1</h1>');

      // åˆ†éš”çº¿
      html = html.replace(/^---+$/gm, '<hr>');
      html = html.replace(/^\*\*\*+$/gm, '<hr>');

      // å¼•ç”¨å—
      html = html.replace(/^> (.+)$/gm, '<blockquote><p>$1</p></blockquote>');
      html = html.replace(/<\/blockquote>\n<blockquote>/g, '\n');

      // ä»»åŠ¡åˆ—è¡¨
      html = html.replace(/^- \[x\] (.+)$/gm, '<li class="task-list-item"><input type="checkbox" checked disabled> $1</li>');
      html = html.replace(/^- \[ \] (.+)$/gm, '<li class="task-list-item"><input type="checkbox" disabled> $1</li>');

      // æ— åºåˆ—è¡¨
      html = html.replace(/^[\*\-] (.+)$/gm, '<li>$1</li>');
      html = html.replace(/(<li>.*<\/li>\n?)+/g, '<ul>$&</ul>');

      // æœ‰åºåˆ—è¡¨
      html = html.replace(/^\d+\. (.+)$/gm, '<oli>$1</oli>');
      html = html.replace(/(<oli>.*<\/oli>\n?)+/g, match => {
        return '<ol>' + match.replace(/<\/?oli>/g, m => m === '<oli>' ? '<li>' : '</li>') + '</ol>';
      });

      // è¡¨æ ¼
      html = html.replace(/^\|(.+)\|\n\|[-:\| ]+\|\n((\|.+\|\n?)+)/gm, (match, header, sep, body) => {
        const headers = header.split('|').filter(h => h.trim()).map(h => `<th>${h.trim()}</th>`).join('');
        const rows = body.trim().split('\n').map(row => {
          const cells = row.split('|').filter(c => c.trim()).map(c => `<td>${c.trim()}</td>`).join('');
          return `<tr>${cells}</tr>`;
        }).join('');
        return `<table><thead><tr>${headers}</tr></thead><tbody>${rows}</tbody></table>`;
      });

      // å›¾ç‰‡
      html = html.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, '<img src="$2" alt="$1">');

      // é“¾æ¥
      html = html.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank">$1</a>');

      // ç²—ä½“å’Œæ–œä½“
      html = html.replace(/\*\*\*(.+?)\*\*\*/g, '<strong><em>$1</em></strong>');
      html = html.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
      html = html.replace(/\*(.+?)\*/g, '<em>$1</em>');
      html = html.replace(/~~(.+?)~~/g, '<del>$1</del>');

      // æ®µè½
      html = html.replace(/\n\n+/g, '</p><p>');
      html = '<p>' + html + '</p>';
      html = html.replace(/<p>\s*<(h[1-6]|ul|ol|blockquote|pre|hr|table)/g, '<$1');
      html = html.replace(/<\/(h[1-6]|ul|ol|blockquote|pre|hr|table)>\s*<\/p>/g, '</$1>');
      html = html.replace(/<p>\s*<\/p>/g, '');

      // è¿˜åŸä»£ç å—
      codeBlocks.forEach((block, index) => {
        html = html.replace(`___CODEBLOCK_${index}___`, block);
      });
      
      // è¿˜åŸè¡Œå†…ä»£ç 
      inlineCodes.forEach((code, index) => {
        html = html.replace(`___INLINECODE_${index}___`, code);
      });

      return html;
    }

    // HTMLè½¬ä¹‰
    function escapeHtml(text) {
      const map = {
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        '"': '&quot;',
        "'": '&#039;'
      };
      return text.replace(/[&<>"']/g, m => map[m]);
    }

    // åœ¨å…‰æ ‡ä½ç½®æ’å…¥æ–‡æœ¬
    function insertAtCursor(text) {
      const start = markdownInput.selectionStart;
      const end = markdownInput.selectionEnd;
      const value = markdownInput.value;
      
      markdownInput.value = value.substring(0, start) + text + value.substring(end);
      markdownInput.selectionStart = markdownInput.selectionEnd = start + text.length;
      markdownInput.focus();
      updatePreview();
      updateCounts();
    }

    // æ’å…¥åŒ…å›´æ–‡æœ¬
    function insertText(before, after) {
      const start = markdownInput.selectionStart;
      const end = markdownInput.selectionEnd;
      const value = markdownInput.value;
      const selectedText = value.substring(start, end) || 'æ–‡æœ¬';
      
      markdownInput.value = value.substring(0, start) + before + selectedText + after + value.substring(end);
      markdownInput.selectionStart = start + before.length;
      markdownInput.selectionEnd = start + before.length + selectedText.length;
      markdownInput.focus();
      updatePreview();
      updateCounts();
    }

    // æ’å…¥æ ‡é¢˜
    function insertHeading(level) {
      const prefix = '#'.repeat(level) + ' ';
      const start = markdownInput.selectionStart;
      const value = markdownInput.value;
      
      // æ‰¾åˆ°å½“å‰è¡Œçš„å¼€å§‹
      let lineStart = start;
      while (lineStart > 0 && value[lineStart - 1] !== '\n') {
        lineStart--;
      }
      
      // æ£€æŸ¥æ˜¯å¦å·²æœ‰æ ‡é¢˜ç¬¦å·
      const lineContent = value.substring(lineStart);
      const existingMatch = lineContent.match(/^#+\s*/);
      
      if (existingMatch) {
        // æ›¿æ¢ç°æœ‰æ ‡é¢˜ç¬¦å·
        markdownInput.value = value.substring(0, lineStart) + prefix + lineContent.substring(existingMatch[0].length);
      } else {
        // æ·»åŠ æ ‡é¢˜ç¬¦å·
        markdownInput.value = value.substring(0, lineStart) + prefix + value.substring(lineStart);
      }
      
      markdownInput.focus();
      updatePreview();
      updateCounts();
    }

    // æ’å…¥åˆ—è¡¨
    function insertList(type) {
      let prefix;
      switch(type) {
        case 'ul': prefix = '- '; break;
        case 'ol': prefix = '1. '; break;
        case 'task': prefix = '- [ ] '; break;
      }
      insertAtCursor('\n' + prefix + 'åˆ—è¡¨é¡¹\n');
    }

    // æ’å…¥é“¾æ¥
    function insertLink() {
      const url = prompt('è¯·è¾“å…¥é“¾æ¥åœ°å€:', 'https://');
      if (url) {
        insertText('[', `](${url})`);
      }
    }

    // æ’å…¥å›¾ç‰‡
    function insertImage() {
      const url = prompt('è¯·è¾“å…¥å›¾ç‰‡åœ°å€:', 'https://');
      if (url) {
        insertAtCursor(`![å›¾ç‰‡æè¿°](${url})`);
      }
    }

    // æ’å…¥è¡¨æ ¼
    function insertTable() {
      const table = `
| è¡¨å¤´1 | è¡¨å¤´2 | è¡¨å¤´3 |
|-------|-------|-------|
| å•å…ƒæ ¼ | å•å…ƒæ ¼ | å•å…ƒæ ¼ |
| å•å…ƒæ ¼ | å•å…ƒæ ¼ | å•å…ƒæ ¼ |
`;
      insertAtCursor(table);
    }

    // æ’å…¥ä»£ç å—
    function insertCodeBlock() {
      const lang = prompt('è¯·è¾“å…¥ç¼–ç¨‹è¯­è¨€ (å¦‚ javascript, python):', 'javascript');
      insertAtCursor('\n```' + (lang || '') + '\n// ä»£ç \n```\n');
    }

    // æ’å…¥å¼•ç”¨
    function insertQuote() {
      insertAtCursor('\n> å¼•ç”¨æ–‡æœ¬\n');
    }

    // æ’å…¥åˆ†éš”çº¿
    function insertHr() {
      insertAtCursor('\n---\n');
    }

    // å¿«æ·é”®å¤„ç†
    function handleKeyboard(e) {
      if (e.ctrlKey || e.metaKey) {
        switch(e.key.toLowerCase()) {
          case 'b':
            e.preventDefault();
            insertText('**', '**');
            break;
          case 'i':
            e.preventDefault();
            insertText('*', '*');
            break;
          case 'k':
            e.preventDefault();
            insertLink();
            break;
        }
      }
    }

    // å¯¼å‡ºHTML
    function exportHTML() {
      const markdown = markdownInput.value;
      const htmlContent = parseMarkdown(markdown);
      
      const fullHtml = `<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Markdown å¯¼å‡º<\/title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 40px 20px;
      line-height: 1.6;
      color: #333;
    }
    h1 { border-bottom: 2px solid #d4af37; padding-bottom: 10px; }
    h2 { border-bottom: 1px solid #ddd; padding-bottom: 8px; }
    code { background: #f5f5f5; padding: 2px 6px; border-radius: 4px; }
    pre { background: #f5f5f5; padding: 15px; border-radius: 8px; overflow-x: auto; }
    pre code { background: none; padding: 0; }
    blockquote { border-left: 4px solid #d4af37; padding-left: 20px; margin-left: 0; color: #666; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ddd; padding: 10px; }
    th { background: #f5f5f5; }
    img { max-width: 100%; }
    a { color: #d4af37; }
  <\/style>
<\/head>
<body>
${htmlContent}
<\/body>
<\/html>`;
      
      downloadFile(fullHtml, 'markdown-export.html', 'text/html');
      showToast('HTML å¯¼å‡ºæˆåŠŸ', 'success');
    }

    // å¯¼å‡ºPDF
    function exportPDF() {
      const markdown = markdownInput.value;
      const htmlContent = parseMarkdown(markdown);
      
      // åˆ›å»ºæ‰“å°çª—å£
      const printWindow = window.open('', '_blank');
      printWindow.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
          <meta charset="UTF-8">
          <title>Markdown å¯¼å‡º<\/title>
          <style>
            body {
              font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
              max-width: 800px;
              margin: 0 auto;
              padding: 40px;
              line-height: 1.6;
              color: #333;
            }
            h1 { border-bottom: 2px solid #d4af37; padding-bottom: 10px; }
            h2 { border-bottom: 1px solid #ddd; padding-bottom: 8px; }
            code { background: #f5f5f5; padding: 2px 6px; border-radius: 4px; }
            pre { background: #f5f5f5; padding: 15px; border-radius: 8px; overflow-x: auto; }
            pre code { background: none; padding: 0; }
            blockquote { border-left: 4px solid #d4af37; padding-left: 20px; margin-left: 0; color: #666; }
            table { border-collapse: collapse; width: 100%; }
            th, td { border: 1px solid #ddd; padding: 10px; }
            th { background: #f5f5f5; }
            img { max-width: 100%; }
            a { color: #d4af37; }
            @media print {
              body { padding: 20px; }
            }
          <\/style>
        <\/head>
        <body>
          ${htmlContent}
          <script>
            window.onload = function() {
              window.print();
            };
          <\/script>
        <\/body>
        <\/html>
      `);
      printWindow.document.close();
      
      showToast('è¯·åœ¨æ‰“å°å¯¹è¯æ¡†ä¸­é€‰æ‹©"ä¿å­˜ä¸ºPDF"', 'success');
    }

    // ä¸‹è½½æ–‡ä»¶
    function downloadFile(content, filename, type) {
      const blob = new Blob([content], { type: type });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    // æ¸…ç©ºç¼–è¾‘å™¨
    function clearEditor() {
      if (confirm('ç¡®å®šè¦æ¸…ç©ºç¼–è¾‘å™¨å—ï¼Ÿ')) {
        markdownInput.value = '';
        updatePreview();
        updateCounts();
        showToast('ç¼–è¾‘å™¨å·²æ¸…ç©º', 'success');
      }
    }

    // Toasté€šçŸ¥
    function showToast(message, type = 'success') {
      toast.textContent = message;
      toast.className = 'toast ' + type + ' show';
      setTimeout(() => {
        toast.classList.remove('show');
      }, 2500);
    }
  </script>
</body>
</html>
