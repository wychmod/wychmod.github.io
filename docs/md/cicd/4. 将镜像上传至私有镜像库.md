## 什么是镜像库

字面意思，镜像库就是集中存放镜像的一个文件服务。镜像库在 `CI/CD` 中，又称 `制品库` 。构建后的产物称为**制品**，制品则要放到**制品库**做**中转和版本管理**。常用平台有**Nexus，Jfrog，Harbor**或其他对象存储平台。

在这里，我们选用 `Nexus3` 作为自己的镜像库。因为其稳定，性能好，免费，部署方便，且支持类型多，是许多制品库的首选选型。

## 部署 Nexus 服务

在部署 `Nexus` 之前，需要先下载 `Nexus` 的安装包（这里需要另外找个托管服务）

```shell
wget https://dependency-fe.oss-cn-beijing.aliyuncs.com/nexus-3.29.0-02-unix.tar.gz
```

下载完成后，解压安装包

```shell
tar -zxvf ./nexus-3.29.0-02-unix.tar.gz
```

解压后，我们可以看到有2个文件夹。分别是 `nexus-3.29.0-02` 和 `sonatype-work` 。其中，`nexus-3.29.0-02` 是nexus主程序文件夹，`sonatype-work` 则是数据文件。

## 启动 Nexus

我们进入 `nexus-3.29.0-02` 下面的 `bin` 目录，这里就是 `nexus` 的主命令目录。我们在 `bin` 目录下，执行 `./nexus start` 命令即可启动 `nexus` ：

```shell
./nexus start
```

> nexus 还支持停止，重启等命令。可以在 bin 目录下执行 ./nexus help 查看更多命令

由于 `nexus` 默认服务端口是 `8081`，稍后我们还需要给镜像库访问单独开放一个 `8082` 端口。这里将 `8081`，`8082` 端口添加到防火墙放行规则内（没开防火墙则可以略过）：

```shell
firewall-cmd --zone=public --add-port=8081/tcp --permanent
firewall-cmd --zone=public --add-port=8082/tcp --permanent
```

打开浏览器地址栏，访问 `IP:8081` 。启动时间比较长，需要耐心等待。在 `Nexus` 启动后，会进入这个欢迎页面：

![](../youdaonote-images/Pasted%20image%2020230417234351.png)

## 配置 Nexus

进入欢迎页后，点击右上角的登录，会打开登录框。这里需要我们输入 `默认管理员密码` 进行初始化配置。

![](../youdaonote-images/Pasted%20image%2020230417234408.png)

可以在这里找到：

```shell
cat /opt/nexus/sonatype-work/nexus3/admin.password
# 0ee35fa5-d773-432b-8e76-6c10c940ccd9
```

将文件中获取到的密码输入进去，登录用户名是 `admin` 。

接着是修改新密码。修改后，会进入下图这一步。这一步的意思是**是否开启匿名访问**。匿名访问是指：**我们在没有登录的情况下，拉取（推送）制品到制品库，都算匿名访问。**这是个很便捷，也是个危险的行为。

![](../youdaonote-images/Pasted%20image%2020230417234438.png)

## 创建一个 Docker 私服

登录完成后，点击页面头部导航栏的**齿轮**图标，选择左侧菜单中的 `Repositories` ，点击 `Create repository` 。

![](../youdaonote-images/Pasted%20image%2020230417234605.png)

