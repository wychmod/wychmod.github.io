# 问题 1 的模型建立与求解
## 问题1的分析
问题1的目标是要求给出板材的切割方案以达到满足订单需求，在相关约束的条件下，尽可能的减少板材用量。由于问题1的数据集中单个数据表中所需要的切割板材的材料是相同的，以及没有要求相同订单的板材要出自同一次板材切割，所以可以忽略数据集中的材料和订单项，同时不用考虑虑锯缝宽度的影响，仅考虑不同长宽的产品项的排样优化。
为了满足订单需求，要在满足硬约束条件下，尽可能少的使用板材，以最大化板材的利用率为目标函数，从而求解问题1。
1. 唯一性约束：相同栈里的产品项的宽度或长度应该相同。
2. 完整性约束：要求最终切割生成的产品项是完整的，不是由其他切割出来的项拼接而成的，同时生成的产品项数量符合需求中要求的数量。
3. 切割方式约束：要求切割方式必须是齐头切，即直线切割，切割方向垂直于板材的一条边，保证每次直线切割可以分离成两块。
4. 切割阶段数约束：切割阶段数不超过3，同一个阶段切割方向相同，即一个产品项被切割下来最多有2次切割方向的转变。
5. 精确排样约束：要求为3E方式或者3H方式的精确排样。
## 模型的准备与建立
### 数据定义
1. 变量
pi(小i，我打不出来)——第i种排样方式，i=1,2,...(省略号),n
fij(小i，小j，我打不出来)——第i种排样方式上j型号的零件数量,j=1,2,...(省略号),m
xi(小i，我打不出来)——i种排样方式在板材上的使用频率，即有多少张板材使用这种排样方式。
mj(小j，我打不出来)——j种零件需要的总数。
*大概和下面一样：*
![](youdaonote-images/Pasted%20image%2020221009144849.png)

### 问题1的模型建立
1. 目标函数：由问题1可知，为了尽可能的减少板材的使用量，应该在此基础上优化板材的排样方式，提高单个板材的利用率。因此本文以不同排样方式在板材上的使用频率xi(小i，我打不出来)的数量为目标进行建模，目标函数如下：
![](youdaonote-images/Pasted%20image%2020221009145553.png)
2. 完整性约束，要求最终生成的产品项要是完整的不是拼接的fji*xi，同时要求数量上面符合需求中要求的数量mj(小j，我打不出来)：
![](youdaonote-images/Pasted%20image%2020221009150547.png)
3.唯一性约束，长和宽相同的产品项可以视为同一个产品。
4.综上，可以建立问题1的数学模型，见MOD1
![](youdaonote-images/Pasted%20image%2020221009150731.png)

## 模型的求解与分析
问题1 模型的特点及算法引入： 在切割方式和切割阶段数的约束下，板材会逐步形成条带、栈、产品项三种不同阶段的板材，所以我们针对生成的最小单位产品项为基本单位来进行思考，不断组合成栈、条带和原始板材。由此可以知道排样问题是一个组合优化问题，当数据量具有一定的规模，当扩大求解规模后，可行解的数量会呈现指数增长。如果使用全排列的方式来进行求解，将每一个需求的产品项进行组合，然后形成不同的排样方式，对所需的原板数量进行求解。这中方法会导致维数灾难【1】。华南理工大学的陈秋莲博士针对二维剪切下料问题排样方案问题提出了优化算法，这是一种迭代顺序价值修正算法，已被证实这种算法生成的排样方案优于商业软件的同类三阶段排样方案【2】。这里我们参考了该种算法并延伸出一种贪心算法来针对栈和条带的生成。美国Michigan 大学的 Holland 教授提出的遗传算法（Genetic Algorithm，GA）是求解复杂组合优化问题的有效方法，是求解全局最优化问题的一种新型算法，它是模仿生物进化与遗传原理而设计的一类随机搜索的优化方法。在生成条带之后，组合优化的维度大大降低，我们对条带进行遗传算法使其收敛到全局最优解【3】。

### 算法设计
对于板材的切割，已知切割方式必须是齐头切，切割的阶段数不能超过3段，必须符合3E方式或者3H方式的精确排样。从原板材会逐步被切割为条带、栈和产品项，如图1。同时从我们的数据集出发我们已知条件是每个产品项的长和宽，然后我们设计出了一种贪心算法与遗传算法相结合的方式来对问题进行求解。

![](youdaonote-images/Pasted%20image%2020221009191757.png)

贪心算法的基本思想是对问题求解时，总是做出在当前看来是最好的选择。即不从整体最优上加以考虑，所做出的都是某种意义上的局部最优解。通过一系列的局部最优来达到全局最优。在这里我们通过对排样的局部最优解来进行栈和条带的生成，在多次实验测试的情况下，比在栈和条带的生成阶段就使用遗传算法来进行组合的方式，对于板材的利用率更高。算法分为如下的步骤进行求解：

step1 产品项组成条带和栈的设计

首先先将所有产品项数据进行预处理，将每个产品项都按照长边是边长较大的，短边是边长较短的来进行处理，因为数据中有一部分产品项的长比宽是要短的。在这个预处理的过程中，将每个产品项的面积计算出来。之后参考陈秋莲博士论文中提到的，工人习惯于先去处理面积大的产品项，这样可以和剩余的产品项在同一个原板上进行组合，可以有效提高利用率。如果最后才处理面积大的产品项，这样这些面积大的产品项就只能单独放一块板子上【2】。基于这个思路，我们将面积最大的产品项放到原板的左下方，让这块板材独立形成栈。同时让该产品项的宽度为当前条带的宽度，起到固定条带宽度的作用。如图2。

![](youdaonote-images/Pasted%20image%2020221009185454.png)

然后根据条带右下固定部分的面积，从剩下的产品项中找寻能够放入右下固定部分面积最大的产品项，如果不存在能够放入的产品项，则输出该条带。如果存在符合右下固定面积的产品项则放入，之后判断该栈的上方是否存在边长与该栈宽度相同的同时面积符合的产品项，选择面积最大产品项进行放入，这种排布方法属于均质排布。如图3。这里涉及一个贪心的思路，不断的选择面积最大的板材进行填充以获得局部最优的解，之后不断采用这种贪心的填充策略，目的是用这种局部最优解来得出全局相对最优的解。这种贪心的方法要比单纯用均质和同质排布来形成的条带的方式更好一些，因为单纯用均值和同质来进行排布对于条带的高没有一个明确的判断标准，很容易一个条带就占据了一个原板，同时条带内部也有很多空缺，使得板材的利用率不高。

![](youdaonote-images/Pasted%20image%2020221009192220.png)

之后针对如果右下方还有剩余可以填充的面积，不断重复上面的填充过程。如图4.

![](youdaonote-images/Pasted%20image%2020221009192149.png)

step2 使用遗传算法对条带之间拼接

遗传算法的基本思想是通过大量备选解的变换、迭代和变异，在解空间中并行动态地进行全局搜索的最优化方法。我们采用了遗传算法来求解条带之间的拼接问题。首先对条带进行数据预处理的操作，先将无法与其他条带拼接的面积较大的条带进行剔除，这样的条带独占一个原始的板材。剩下的条带可以进行组合，因为剩下的条带数量级远小于最开始的产品项的数量，所以在这一步使用遗传算法，时间效率更高，更易得出最优解。遗传算法的详细步骤如下。



[4]刘诚,孙远升,花军,贾娜.基于贪心算法及局部枚举策略的人造板排样方案研究[J].木材科学与技术,2021,35(06):55-61.


[1]邓小武. 面向复杂高维数据的张量学习理论与方法研究[D].杭州电子科技大学,2019.DOI:10.27075/d.cnki.ghzdc.2019.000234.
【2】 就是文档里发的那个论文
[3]冯建云,刘祎.面向利用率的矩形排样分级进化遗传算法优化[J/OL].机械设计与制造:1-6[2022-10-09].DOI:10.19356/j.cnki.1001-3997.20220721.015.

